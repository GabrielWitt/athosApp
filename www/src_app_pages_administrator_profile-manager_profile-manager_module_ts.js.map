{"version":3,"file":"src_app_pages_administrator_profile-manager_profile-manager_module_ts.js","mappings":"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","sources":["./src/app/pages/administrator/profile-manager/profile-manager-routing.module.ts","./src/app/pages/administrator/profile-manager/profile-manager.module.ts","./src/app/pages/administrator/profile-manager/profile-manager.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { ProfileManagerPage } from './profile-manager.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ProfileManagerPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class ProfileManagerPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { ProfileManagerPageRoutingModule } from './profile-manager-routing.module';\n\nimport { ProfileManagerPage } from './profile-manager.page';\nimport { SharedModule } from 'src/app/shared/shared.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    SharedModule,\n    ReactiveFormsModule,\n    ProfileManagerPageRoutingModule,\n    SharedModule\n  ],\n  declarations: [ProfileManagerPage]\n})\nexport class ProfileManagerPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { User, userFormData } from 'src/app/core/models/user';\nimport { AlertsService } from 'src/app/shared/utilities/alerts';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { VerificationFuncService } from 'src/app/shared/utilities/verificationFunc';\nimport { attachmentOptions, UserPhoto } from 'src/app/core/models/images';\nimport { AttachmentsService } from 'src/app/shared/utilities/attachments.service';\nimport { ImageUploaderService } from 'src/app/core/services/image-uploader.service';\nimport { IonRouterOutlet, ModalController } from '@ionic/angular';\nimport { FireAuthService } from 'src/app/core/services/modules/fire-auth.service';\n\n@Component({\n  selector: 'app-profile-manager',\n  templateUrl: './profile-manager.page.html',\n  styleUrls: ['./profile-manager.page.scss'],\n})\nexport class ProfileManagerPage implements OnInit {\n  loading = false;\n  edit = false;\n  defaultUser = '../../../../assets/profile/ProfileBlank.png';\n  newImage;\n  progress=0;\n\n  user: User;\n  userData: userFormData;\n\n  registerForm: FormGroup;\n  validationMessages  = {\n    name:[ {type: 'required', message: ' Escribe tu nombre'},],\n    lastName:[ {type: 'required', message: ' Escribe tu apellido'},],\n    birthday:[ {type: 'required', message: ' Ingresa tu fecha de nacimiento'},]\n  };\n\n  // DARK MODE\n  prefersDark = window.matchMedia('(prefers-color-scheme: dark)');\n  darkModeToggle = false;\n\n  constructor(\n    private alerts: AlertsService,\n    private modal: ModalController,\n    private upload: ImageUploaderService,\n    private images: AttachmentsService,\n    private routerOutlet: IonRouterOutlet,\n    private formBuilder: FormBuilder,\n    private auth: FireAuthService,\n    private verification: VerificationFuncService,\n  ) { }\n\n  ngOnInit() {\n    this.registerForm = this.formBuilder.group({\n      name:[null, { validators: [Validators.required, Validators.minLength(2)] }],\n      lastName:[null, { validators: [Validators.required, Validators.minLength(3)] }],\n      birthday:[null, { validators: [Validators.required] }]\n    });\n    this.checkUser().then(ok => {\n      this.images.loadSaved().then((attachment: any) => {\n        if (attachment.length && attachment[0].deploy){\n          this.changeProfileImage(attachment[0]);\n        }\n      });\n    });\n  }\n\n  EnterSubmit(evt, form){\n    this.verification.EnterSubmit(evt,form,this.loading).then(answer => {\n      if(answer){ console.log('Enter') }\n    })\n  }\n\n  checkUser() {\n    return new Promise((resolve, reject) => {\n      try {\n        this.loading = true;\n        this.auth.getUser().then((user: any) =>{\n          console.log(user);\n          this.user = user.user;\n          this.userData = user.data;\n          this.loading = false;\n        });\n      } catch (error) {\n        console.log(error);\n        this.loading = false;\n        reject(error);\n      }\n    })\n  }\n\n  editForm(){\n    if(!this.edit){\n      this.edit = !this.edit;\n      this.registerForm = this.formBuilder.group({\n        name:[this.userData.name, { validators: [Validators.required, Validators.minLength(2)] }],\n        lastName:[this.userData.lastName, { validators: [Validators.required, Validators.minLength(3)] }],\n        birthday:[this.userData.birthDate, { validators: [Validators.required] }]\n      });\n    } else {\n      const newValues = this.registerForm.value;\n      const nameCheck = this.userData.name !== newValues.name;\n      const lastNameCheck = this.userData.lastName !== newValues.lastName;\n      const birthDateCheck = this.userData.birthDate !== newValues.birthday;\n      if(nameCheck || lastNameCheck || birthDateCheck) {\n        this.loading = true;\n        const data = {\n          ...this.userData,\n          name: newValues.name,\n          lastName: newValues.lastName,\n          birthDate: newValues.birthday\n        }\n        this.auth.uploadUserForm(this.user.uid, data)\n        .then(ok => { \n          this.edit = !this.edit;\n          this.alerts.showAlert('PERFIL','Tus datos han sido actualizados','OK');\n          this.checkUser();\n          this.loading = false;\n        })\n      } else{\n        this.edit = !this.edit;\n      }\n    }\n  }\n\n  // IMAGE SYSTEM\n  addPhoto() {\n    const options: attachmentOptions = {\n      currentRoute: 'manager/profile',\n      height:null, width:null, pdf: false\n    }\n    this.images.presentImageOptions(options).then(imageObj => {\n      if (imageObj[0] !== undefined){\n        this.changeProfileImage(imageObj[0]);\n      }\n    });\n  }\n\n  changeProfileImage(image: UserPhoto){\n    this.loading = true;\n    this.newImage = image;\n    const imageName = Date().toString()+'_'+this.user.uid;\n    this.upload.uploadFile('profile',imageName, image.file,\n    (progress)=>{ this.progress = progress })\n    .then((data:any) => {\n      this.auth.updateUser('administrador', data.url).then(done => {\n        this.alerts.showAlert('PERFIL','Tus imagen de perfil ha sido actualizada','OK');\n        this.upload.deletePicture();\n        this.newImage = null;\n        this.checkUser();\n        this.loading = false;\n      })\n    })\n  }\n\n  upgradeProfile(){\n    this.loading = true;\n    this.auth.upgradeUser('empleado').then((done: any) => {\n      this.alerts.showAlert('PERFIL',done,'OK');\n      this.checkUser();\n      this.loading = false;\n    })\n  }\n\n  async doRefresh(refresh?){\n    await this.checkUser().then(done => {\n      console.log('done');\n      if (refresh){ refresh.target.complete(); }\n    }).catch(error => {\n      console.log(error);\n      if (refresh){ refresh.target.complete(); }\n    })\n  }\n\n}"],"names":["Component","AlertsService","FormBuilder","Validators","VerificationFuncService","AttachmentsService","ImageUploaderService","IonRouterOutlet","ModalController","FireAuthService","ProfileManagerPage","constructor","alerts","modal","upload","images","routerOutlet","formBuilder","auth","verification","name","type","message","lastName","birthday","window","matchMedia","ngOnInit","registerForm","group","validators","required","minLength","checkUser","then","ok","loadSaved","attachment","length","deploy","changeProfileImage","EnterSubmit","evt","form","loading","answer","console","log","Promise","resolve","reject","getUser","user","userData","data","error","editForm","edit","birthDate","newValues","value","nameCheck","lastNameCheck","birthDateCheck","uploadUserForm","uid","showAlert","addPhoto","options","currentRoute","height","width","pdf","presentImageOptions","imageObj","undefined","image","newImage","imageName","Date","toString","uploadFile","file","progress","updateUser","url","done","deletePicture","upgradeProfile","upgradeUser","doRefresh","refresh","target","complete","catch","selector","template"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}